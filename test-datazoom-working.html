<!DOCTYPE html>
<html>
<head>
    <title>DataZoom Working Test</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        #chart { width: 100%; height: 400px; border: 1px solid #ccc; margin: 20px 0; }
        .buttons { margin: 20px 0; }
        button { padding: 10px 20px; margin-right: 10px; }
        .status { padding: 10px; background: #f0f0f0; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Testing DataZoom Functionality</h1>
        <p>This test verifies that dataZoom actually filters the chart data when moved</p>
        
        <div class="buttons">
            <button onclick="addDataZoom()">Add DataZoom</button>
            <button onclick="removeDataZoom()">Remove DataZoom</button>
            <button onclick="logCurrentOptions()">Log Current Options</button>
            <button onclick="testSetOption()">Test setOption with dataZoom</button>
        </div>
        
        <div id="chart"></div>
        
        <div class="status" id="status">Ready</div>
    </div>

    <script>
        const chartDom = document.getElementById('chart');
        const statusDiv = document.getElementById('status');
        const myChart = echarts.init(chartDom);
        
        // Base options - same as AiChatLike first chart
        const baseOption = {
            title: {
                text: 'Weekly Temperature',
                left: 'center'
            },
            tooltip: {
                trigger: 'axis'
            },
            xAxis: {
                type: 'category',
                data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
            },
            yAxis: {
                type: 'value',
                name: 'Temperature (Â°C)'
            },
            series: [
                {
                    name: 'Temperature',
                    type: 'line',
                    data: [20, 22, 21, 23, 25, 26, 23],
                    smooth: true
                }
            ]
        };
        
        // Initialize chart
        myChart.setOption(baseOption);
        updateStatus('Chart initialized with base options');
        
        // Listen for dataZoom events
        myChart.on('datazoom', function(params) {
            console.log('DataZoom event:', params);
            updateStatus(`DataZoom event - start: ${params.start?.toFixed(2)}%, end: ${params.end?.toFixed(2)}%`);
        });
        
        function updateStatus(msg) {
            statusDiv.textContent = msg;
            console.log(msg);
        }
        
        function addDataZoom() {
            updateStatus('Adding dataZoom...');
            
            const options = {
                dataZoom: [{
                    type: 'slider',
                    show: true,
                    start: 0,
                    end: 100,
                    xAxisIndex: 0,
                    filterMode: 'filter'
                }]
            };
            
            // Test both merge modes
            console.log('Applying dataZoom with notMerge: false');
            myChart.setOption(options, { notMerge: false });
            
            updateStatus('DataZoom added - drag the handles to zoom');
        }
        
        function removeDataZoom() {
            updateStatus('Removing dataZoom...');
            
            // Method 1: Set empty array
            myChart.setOption({
                dataZoom: []
            }, { notMerge: false });
            
            updateStatus('DataZoom removed');
        }
        
        function logCurrentOptions() {
            const opts = myChart.getOption();
            console.log('Current options:', opts);
            console.log('DataZoom config:', opts.dataZoom);
            console.log('Series data:', opts.series[0].data);
            updateStatus('Options logged to console');
        }
        
        function testSetOption() {
            updateStatus('Testing setOption with dataZoom included...');
            
            // Create new options that include dataZoom
            const newOptions = {
                ...baseOption,
                dataZoom: [{
                    type: 'slider',
                    show: true,
                    start: 20,
                    end: 80,
                    xAxisIndex: 0,
                    filterMode: 'filter'
                }]
            };
            
            console.log('Setting complete options with dataZoom');
            myChart.setOption(newOptions, { notMerge: true });
            
            updateStatus('Complete options set with dataZoom (20% - 80%)');
        }
    </script>
</body>
</html>